# Luxtronik firmware analysis

## Motivation

I own a Alpha Innotec heatpump and wanted to integrate it into my Smart home.
As a natural born tinkerer It was clear that I'm going to reverse engeneer what ever possible in order to achive my goal ðŸ¤“

## Firmware updates

You can find the latest firmwar files here:

- [Alpha Innotec](https://www.heatpump24.com/DownloadArea.php?layout=1&lang=5)
- [Siemens Novelan](https://www.heatpump24.com/DownloadArea.php?layout=2&lang=5) 
- [CAT](https://www.heatpump24.com/DownloadArea.php?layout=3&lang=5)

The url is `https://www.heatpump24.com/DownloadArea.php?layout=1&lang=5` and by changing the `layout=` GET parameterfrom 1 to 2 or 3 you get the download menu for one of the three manufacturers.

## Heatpump models

See [MODELS.md](MODELS.md)

Generated by `heatpump_models.py` 

## Firmware download and decompression

Can be done using `luxtronik_firmware.sh`. Results in an extracted firmware in the `./firmware` subfolder, except for `software 0` (see [MODELS.md](MODELS.md) for reference).

You get this:

```
firmware
â”œâ”€â”€ appl
â”œâ”€â”€ appl.cfg
â”œâ”€â”€ bootloader.lin
â”œâ”€â”€ Defines.txt
â”œâ”€â”€ index.html
â”œâ”€â”€ lang_cz
â”œâ”€â”€ lang_dan
â”œâ”€â”€ lang_de
â”œâ”€â”€ lang_ee
â”œâ”€â”€ lang_en
â”œâ”€â”€ lang_es
â”œâ”€â”€ lang_fr
â”œâ”€â”€ lang_hr
â”œâ”€â”€ lang_it
â”œâ”€â”€ lang_lt
â”œâ”€â”€ lang_lv
â”œâ”€â”€ lang_mag
â”œâ”€â”€ lang_ned
â”œâ”€â”€ lang_nor
â”œâ”€â”€ lang_p
â”œâ”€â”€ lang_pol
â”œâ”€â”€ lang_ro
â”œâ”€â”€ lang_sk
â”œâ”€â”€ lang_slo
â”œâ”€â”€ lang_suo
â”œâ”€â”€ lang_sve
â”œâ”€â”€ lang_tr
â”œâ”€â”€ LWD.lin
â”œâ”€â”€ LWDRev.lin
â”œâ”€â”€ SWPH291.lin
â”œâ”€â”€ SWPH.lin
â”œâ”€â”€ SWP.lin
â”œâ”€â”€ timezone
â”œâ”€â”€ udhcpc.script
â””â”€â”€ Webserver
    â”œâ”€â”€ base.css
    â”œâ”€â”€ base.jpg
    â”œâ”€â”€ index.html
    â”œâ”€â”€ jquery.js
    â””â”€â”€ Lux.js
```

Or this:

```
firmware
â”œâ”€â”€ appl
â”œâ”€â”€ appl.cfg
â”œâ”€â”€ ASB.bin
â”œâ”€â”€ ASB_BL_Switch.bin
â”œâ”€â”€ ASB_bootloader.bin
â”œâ”€â”€ bootloader.lin
â”œâ”€â”€ Defines.txt
â”œâ”€â”€ HZIO.lin
â”œâ”€â”€ index.html
â”œâ”€â”€ LD2AG.lin
â”œâ”€â”€ LWD45.lin
â”œâ”€â”€ MSW_15.lin
â”œâ”€â”€ MSW_Inverter.lin
â”œâ”€â”€ RBE.bin
â”œâ”€â”€ SEC.bin
â”œâ”€â”€ share
â”‚Â Â  â”œâ”€â”€ localtime
â”‚Â Â  â”œâ”€â”€ passwd
â”‚Â Â  â””â”€â”€ shadow
â”œâ”€â”€ timezone
â”œâ”€â”€ udhcpc.script
â””â”€â”€ Webserver
    â”œâ”€â”€ base.css
    â”œâ”€â”€ index.html
    â”œâ”€â”€ jquery.js
    â”œâ”€â”€ Lux.js
    â”œâ”€â”€ LuxSim.jpg
    â””â”€â”€ saveIcon.png
```

## Root password 

ðŸ˜Ž Yes, you can get the root password for your heatpump from a firmware update!
I'm not sure if that's true for every firmware update but at least a couple I've tested.

1. Download and extract the firmware using `luxtronik_firmware.sh`
2. Run `root_password.sh`

## SSH 

The heatpumps run a fairly old version of Dropbear SSH server which does not support state of the art crypto cyphers.
Therfore you have to specify a weak cipher in order to login.

Use `ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes256-cbc root@192.168.178.100` to get to the login prompt, be sure to replace `192.168.178.100` with the IP of your heatpump.

âš  ATTENTION âš  You are logged in as root which mean that you can easily destroy your heatpump. Be careful with waht you do!

**Edit April 2022**: 

The on my system installed OpenSSH client `OpenSSH_8.9p1, OpenSSL 1.1.1n  15 Mar 2022` does no longer support the `SSH protocol v.1` and therefore the command from above does no longer work.
But I've added a Dockerfile together with a ssh config file and a stript to start the container and drop you in a shell within that container. From there you can ssh into the heatpump.
make sure to adjust the IP address in the config file before you attempt log into your heatpump.


```
cd ssh
./legacy-ssh.sh

# You'll see a bash prompt saying
# bash-5.0#

ssh luxtronik

#Enter ssh passwort for root user and you're logged in 
```

## Filetree

See [FILETREE.md](FILETREE.md)

